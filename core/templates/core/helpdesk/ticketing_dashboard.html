{% extends "base.html" %}
{% load static %}

{% block title %}🎫 Ticketing Dashboard{% endblock %}


{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/ticketing_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

  <!-- Header -->
  <header class="dashboard-header">
    <h1><i class="fas fa-tachometer-alt"></i>Dashboard</h1>
  </header>

  <!-- KPI Stats -->
  <section class="kpi-section">
    {% for label, id, icon in kpi_data %}
      <div class="kpi-card gradient-{{ forloop.counter }}">
        <div class="icon"><i class="fas {{ icon }} fa-2x"></i></div>
        <div class="details">
          <h3>{{ label }}</h3>
          <p id="{{ id }}">0</p>
        </div>
      </div>
    {% endfor %}
  </section>

  <!-- Charts Grid -->
  <section class="charts-grid">

    <!-- Modal Structure -->
    <div id="chartModal" class="modal">
      <div class="modal-content" id="modalContent">
        <!-- More info will be dynamically inserted here -->
      </div>
      <button onclick="document.getElementById('chartModal').style.display='none'">Close</button>
    </div>

    <!-- Ticket Trends Overview -->
    <div class="chart-card full-width" id="ticketTrendsOverview">
      <div class="card-header">
        <h2>📈 Ticket Trends Overview</h2>
        <i class="fas fa-ellipsis-h menu-btn"></i>
      </div>
      <canvas id="overviewChart" class="tall-chart"></canvas>
    </div>

    <!-- Problem Category Trends -->
    <div class="chart-card full-width" id="problemCategoryTrends">
      <div class="card-header">
        <h2>📊 Problem Category Trends</h2>
        <i class="fas fa-ellipsis-h menu-btn"></i>
      </div>
      <canvas id="categoryTimeChart" class="tall-chart"></canvas>
    </div>


    <!-- Ticket Report by Status -->
    <div class="chart-card" id="ticketReportByStatus">
      <div class="card-header"><h2>📋 Ticket Report by Status</h2></div>
      <canvas id="ticketReportChart"></canvas>
    </div>

    <!-- Monthly Trends -->
    <div class="chart-card" id="monthlyTrendsOverview">
      <div class="card-header"><h2>📅 Monthly Trends</h2></div>
      <canvas id="monthlyTrendChart"></canvas>
    </div>

    <!-- Time-based Trends -->
    <div class="chart-card" id="timebasedOverview">
      <div class="card-header"><h2>⏱ Time-Based Trends</h2></div>
      <canvas id="timeTrendChart"></canvas>
    </div>

    <!-- Distribution Breakdown -->
    <div class="chart-card full-width">
      <div class="card-header">
        <h2>🎯 Distribution Breakdown</h2>
      </div>
      <div class="distribution-flex">
        <div>
          <h3>By Priority</h3>
          <canvas id="priorityChart" class="tall-chart"></canvas>
        </div>
        <div>
          <h3>By Status</h3>
          <canvas id="statusChart" class="tall-chart"></canvas>
        </div>
      </div>
    </div>


    <!-- Tickets by Region -->
    <div class="chart-card full-width" id="regionchartOverview">
      <div class="card-header"><h2>🌍 Tickets by Region</h2></div>
      <canvas id="regionChart" class="tall-chart"></canvas>
    </div>


    <!-- Tickets by Terminal -->
    <div class="chart-card full-width" id="terminalChartOverview">
      <div class="card-header">
        <h2>🏢 Tickets by Terminal</h2>
        <i class="fas fa-chart-bar menu-btn"></i>
      </div>
      <canvas id="terminalChart" class="tall-chart"></canvas>
    </div>

    <!-- Tickets by Customer -->
    <div class="chart-card full-width" id="customerChartOverview">
      <div class="card-header"><h2>👤 Tickets by Customer</h2></div>
      <canvas id="customerChart" class="tall-chart"></canvas>
    </div>

  </section>
</div>
{% endblock %}

{% block extra_js %}
<!-- Load Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<!-- injected variables -->
<script>
  const STATUS_DATA = {{ status_data|default:'[]'|safe }};
  const PRIORITY_DATA = {{ priority_data|default:'[]'|safe }};
  const REGION_DATA = {{ region_data|default:"[]"|safe }};
  const MONTHLY_DATA = {{ monthly_data|default:'[]'|safe }};
  const TERMINAL_DATA = {{ terminal_data|default:"[]"|safe }};
  const OVERVIEW_DATA = {{ overview_data|default:'[]'|safe }};
  const CATEGORY_TIME_DATA = {{ category_time_data|default:'[]'|safe }};
  const CUSTOMER_DATA = {{ customer_data|default:'[]'|safe }};
  const TIME_DATA = {{ time_data|default:'{}'|safe }};
  const CATEGORY_DATA = {{ category_data|default:'[]'|safe }};


  if (TIME_DATA) {
    document.getElementById("dailyCount").textContent = TIME_DATA.day;
    document.getElementById("weeklyCount").textContent = TIME_DATA.week;
    document.getElementById("monthlyCount").textContent = TIME_DATA.month;
    document.getElementById("yearlyCount").textContent = TIME_DATA.year;
  }
</script>

<!-- dashboard JS -->
<script src="{% static 'js/ticketing_dashboard.js' %}"></script>
{% endblock %}
